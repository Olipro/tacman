<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>Class: BackgrounDRb::MetaWorker</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />

    <script language="JavaScript" type="text/javascript">
    // <![CDATA[

        function toggleSource( id )
        {
          var elem
          var link

          if( document.getElementById )
          {
            elem = document.getElementById( id )
            link = document.getElementById( "l_" + id )
          }
          else if ( document.all )
          {
            elem = eval( "document.all." + id )
            link = eval( "document.all.l_" + id )
          }
          else
            return false;

          if( elem.style.display == "block" )
          {
            elem.style.display = "none"
            link.innerHTML = "show source"
          }
          else
          {
            elem.style.display = "block"
            link.innerHTML = "hide source"
          }
        }

        function openCode( url )
        {
          window.open( url, "SOURCE_CODE", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=480,width=750" ).focus();
        }
      // ]]>
    </script>
  </head>

  <body>
  <table width="100%" border='0' cellpadding='0' cellspacing='0' class='banner'><tr>
  <td class="file-title"><span class="file-title-prefix">Class</span><br />BackgrounDRb::MetaWorker</td>
  <td align="right">
    <table cellspacing="0" cellpadding="2">
      <tr valign="top">
        <td>In:</td>
        <td>
<a href="../../files/server/meta_worker_rb.html">server/meta_worker.rb</a>
        </td>
      </tr>
    <tr>
      <td>Parent:</td>
      <td>
        <a href="../Packet/Worker.html">
Packet::Worker
         </a>
     </td>
   </tr>
         </table>
        </td>
        </tr>
      </table>
 <!-- banner header -->

  <div id="bodyContent">
      <div id="content">

  <div class="description"><h2><a href="MetaWorker.html">MetaWorker</a> class</h2>
<p>
<a href="../BackgrounDRb.html">BackgrounDRb</a> workers are asynchrounous
reactors which work using events You are free to use threads in your
workers, but be reasonable with them. Following methods are available to
all workers from parent classes.
</p>
<ul>
<li>BackgrounDRb::MetaWorker#connect

<p>
Above method connects to an external tcp server and integrates the
connection within reactor loop of worker. For example:
</p>
<pre>
     class TimeClient
       def receive_data(p_data)
         worker.get_external_data(p_data)
       end

       def post_init
         p &quot;***************** : connection completed&quot;
       end
     end

     class FooWorker &lt; BackgrounDRb::MetaWorker
       set_worker_name :foo_worker
       def create(args = nil)
         external_connection = nil
         connect(&quot;localhost&quot;,11009,TimeClient) { |conn| external_connection = conn }
       end

       def get_external_data(p_data)
         puts &quot;And external data is : #{p_data}&quot;
       end
     end
</pre>
</li>
<li>BackgrounDRb::MetaWorker#start_server

<p>
Above method allows you to start a tcp server from your worker, all the
accepted connections are integrated with event loop of worker
</p>
<pre>
   class TimeServer

     def receive_data(p_data)
     end

     def post_init
       add_periodic_timer(2) { say_hello_world }
     end

     def connection_completed
     end

     def say_hello_world
       p &quot;***************** : invoking hello world #{Time.now}&quot;
       send_data(&quot;Hello World\n&quot;)
     end
   end

   class ServerWorker &lt; BackgrounDRb::MetaWorker
     set_worker_name :server_worker
     def create(args = nil)
       # start the server when worker starts
       start_server(&quot;0.0.0.0&quot;,11009,TimeServer) do |client_connection|
         client_connection.say_hello_world
       end
     end
   end
</pre>
</li>
</ul>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="#M000155">check_for_timer_events</a></li>
  <li><a href="#M000154">connection_completed</a></li>
  <li><a href="#M000157">invoke_worker_method</a></li>
  <li><a href="#M000148">load_schedule</a></li>
  <li><a href="#M000145">load_schedule_from_args</a></li>
  <li><a href="#M000149">new_load_schedule</a></li>
  <li><a href="#M000147">process_request</a></li>
  <li><a href="#M000146">receive_data</a></li>
  <li><a href="#M000151">register_result</a></li>
  <li><a href="#M000150">register_status</a></li>
  <li><a href="#M000156">run_user_threads</a></li>
  <li><a href="#M000152">send_response</a></li>
  <li><a href="#M000153">unbind</a></li>
  <li><a href="#M000144">worker_init</a></li>
  </ul>





  <div class="sectiontitle">Attributes</div>
  <table border='0' cellpadding='5'>
  <tr valign='top'>
    <td class='attr-rw'>
[RW]
    </td>
    <td class='attr-name'>config_file</td>
    <td class='attr-desc'></td>
  </tr>
  <tr valign='top'>
    <td class='attr-rw'>
[RW]
    </td>
    <td class='attr-name'>logger</td>
    <td class='attr-desc'></td>
  </tr>
  <tr valign='top'>
    <td class='attr-rw'>
[RW]
    </td>
    <td class='attr-name'>my_schedule</td>
    <td class='attr-desc'></td>
  </tr>
  <tr valign='top'>
    <td class='attr-rw'>
[RW]
    </td>
    <td class='attr-name'>run_time</td>
    <td class='attr-desc'></td>
  </tr>
  <tr valign='top'>
    <td class='attr-rw'>
[RW]
    </td>
    <td class='attr-name'>thread_pool</td>
    <td class='attr-desc'></td>
  </tr>
  <tr valign='top'>
    <td class='attr-rw'>
[RW]
    </td>
    <td class='attr-name'>trigger</td>
    <td class='attr-desc'></td>
  </tr>
  <tr valign='top'>
    <td class='attr-rw'>
[RW]
    </td>
    <td class='attr-name'>trigger_type</td>
    <td class='attr-desc'></td>
  </tr>
  </table>

<div class="sectiontitle">Public Instance methods</div>
<div class="method">
  <div class="title">
    <a name="M000155"></a><b>check_for_timer_events</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000155_source')" id="l_M000155_source">show source</a> ]</p>
  <div id="M000155_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File server/meta_worker.rb, line 297</span>
297:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_for_timer_events</span>
298:       <span class="ruby-keyword kw">super</span>
299:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@worker_method_triggers</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@worker_method_triggers</span>.<span class="ruby-identifier">empty?</span>
300:       <span class="ruby-ivar">@worker_method_triggers</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>,<span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
301:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:runtime</span>] <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_i</span>
302:           (<span class="ruby-identifier">t_data</span> = <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:data</span>]) <span class="ruby-operator">?</span> <span class="ruby-identifier">send</span>(<span class="ruby-identifier">key</span>,<span class="ruby-identifier">t_data</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">send</span>(<span class="ruby-identifier">key</span>)
303:           <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:runtime</span>] = <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:trigger</span>].<span class="ruby-identifier">fire_time_after</span>(<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>).<span class="ruby-identifier">to_i</span>
304:         <span class="ruby-keyword kw">end</span>
305:       <span class="ruby-keyword kw">end</span>
306:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000154"></a><b>connection_completed</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000154_source')" id="l_M000154_source">show source</a> ]</p>
  <div id="M000154_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File server/meta_worker.rb, line 295</span>
295:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">connection_completed</span>; <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000157"></a><b>invoke_worker_method</b>()
  </div>
  <div class="description">
  <p>
we are overriding the function that checks for timers def <a
href="MetaWorker.html#M000155">check_for_timer_events</a>
</p>
<pre>
  super
  return unless @my_schedule
  if @run_time &lt; Time.now.to_i
    # self.send(@my_schedule[:worker_method]) if self.respond_to?(@my_schedule[:worker_method])
    invoke_worker_method
    @run_time = @trigger.fire_time_after(Time.now).to_i
  end
</pre>
<p>
end
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000157_source')" id="l_M000157_source">show source</a> ]</p>
  <div id="M000157_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File server/meta_worker.rb, line 324</span>
324:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">invoke_worker_method</span>
325:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-ivar">@my_schedule</span>[<span class="ruby-identifier">:worker_method</span>]) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@my_schedule</span>[<span class="ruby-identifier">:data</span>]
326:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@my_schedule</span>[<span class="ruby-identifier">:worker_method</span>],<span class="ruby-ivar">@my_schedule</span>[<span class="ruby-identifier">:data</span>])
327:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-ivar">@my_schedule</span>[<span class="ruby-identifier">:worker_method</span>])
328:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@my_schedule</span>[<span class="ruby-identifier">:worker_method</span>])
329:       <span class="ruby-keyword kw">end</span>
330:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000148"></a><b>load_schedule</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000148_source')" id="l_M000148_source">show source</a> ]</p>
  <div id="M000148_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File server/meta_worker.rb, line 215</span>
215:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_schedule</span>
216:       <span class="ruby-keyword kw">case</span> <span class="ruby-ivar">@my_schedule</span>[<span class="ruby-identifier">:trigger_args</span>]
217:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>
218:         <span class="ruby-ivar">@trigger_type</span> = <span class="ruby-identifier">:cron_trigger</span>
219:         <span class="ruby-identifier">cron_args</span> = <span class="ruby-ivar">@my_schedule</span>[<span class="ruby-identifier">:trigger_args</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;0 0 0 0 0&quot;</span>
220:         <span class="ruby-ivar">@trigger</span> = <span class="ruby-constant">BackgrounDRb</span><span class="ruby-operator">::</span><span class="ruby-constant">CronTrigger</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">cron_args</span>)
221:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Hash</span>
222:         <span class="ruby-ivar">@trigger_type</span> = <span class="ruby-identifier">:trigger</span>
223:         <span class="ruby-ivar">@trigger</span> = <span class="ruby-constant">BackgrounDRb</span><span class="ruby-operator">::</span><span class="ruby-constant">Trigger</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@my_schedule</span>[<span class="ruby-identifier">:trigger_args</span>])
224:       <span class="ruby-keyword kw">end</span>
225:       <span class="ruby-ivar">@run_time</span> = <span class="ruby-ivar">@trigger</span>.<span class="ruby-identifier">fire_time_after</span>(<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>).<span class="ruby-identifier">to_i</span>
226:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000145"></a><b>load_schedule_from_args</b>()
  </div>
  <div class="description">
  <p>
loads workers schedule from options supplied from rails a user may pass
trigger arguments to dynamically define the schedule
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000145_source')" id="l_M000145_source">show source</a> ]</p>
  <div id="M000145_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File server/meta_worker.rb, line 178</span>
178:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_schedule_from_args</span>
179:       <span class="ruby-ivar">@my_schedule</span> = <span class="ruby-ivar">@worker_options</span>[<span class="ruby-identifier">:schedule</span>]
180:       <span class="ruby-identifier">new_load_schedule</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@my_schedule</span>
181:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000149"></a><b>new_load_schedule</b>()
  </div>
  <div class="description">
  <p>
new experimental scheduler
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000149_source')" id="l_M000149_source">show source</a> ]</p>
  <div id="M000149_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File server/meta_worker.rb, line 229</span>
229:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new_load_schedule</span>
230:       <span class="ruby-ivar">@worker_method_triggers</span> = { }
231:       <span class="ruby-ivar">@my_schedule</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>,<span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
232:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:trigger_args</span>]
233:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>
234:           <span class="ruby-identifier">cron_args</span> = <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:trigger_args</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;0 0 0 0 0&quot;</span>
235:           <span class="ruby-identifier">trigger</span> = <span class="ruby-constant">BackgrounDRb</span><span class="ruby-operator">::</span><span class="ruby-constant">CronTrigger</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">cron_args</span>)
236:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Hash</span>
237:           <span class="ruby-identifier">trigger</span> = <span class="ruby-constant">BackgrounDRb</span><span class="ruby-operator">::</span><span class="ruby-constant">Trigger</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:trigger_args</span>])
238:         <span class="ruby-keyword kw">end</span>
239:         <span class="ruby-ivar">@worker_method_triggers</span>[<span class="ruby-identifier">key</span>] = { <span class="ruby-identifier">:trigger</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">trigger</span>,<span class="ruby-identifier">:data</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:data</span>],<span class="ruby-identifier">:runtime</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">trigger</span>.<span class="ruby-identifier">fire_time_after</span>(<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>).<span class="ruby-identifier">to_i</span> }
240:       <span class="ruby-keyword kw">end</span>
241:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000147"></a><b>process_request</b>(p_data)
  </div>
  <div class="description">
  <p>
method is responsible for invoking appropriate method in user
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000147_source')" id="l_M000147_source">show source</a> ]</p>
  <div id="M000147_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File server/meta_worker.rb, line 196</span>
196:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process_request</span>(<span class="ruby-identifier">p_data</span>)
197:       <span class="ruby-identifier">user_input</span> = <span class="ruby-identifier">p_data</span>[<span class="ruby-identifier">:data</span>]
198:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-node">&quot;#{user_input[:worker_method]} #{user_input[:data]}&quot;</span>
199:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">user_input</span>[<span class="ruby-identifier">:worker_method</span>])
200:         <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Undefined method #{user_input[:worker_method]} called on worker #{worker_name}&quot;</span>
201:         <span class="ruby-keyword kw">return</span>
202:       <span class="ruby-keyword kw">end</span>
203:       <span class="ruby-identifier">called_method_arity</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">method</span>(<span class="ruby-identifier">user_input</span>[<span class="ruby-identifier">:worker_method</span>]).<span class="ruby-identifier">arity</span>
204:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Arity of method is #{called_method_arity}&quot;</span>
205:       <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">nil</span>
206:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">called_method_arity</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
207:         <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">user_input</span>[<span class="ruby-identifier">:worker_method</span>],<span class="ruby-identifier">user_input</span>[<span class="ruby-identifier">:data</span>])
208:       <span class="ruby-keyword kw">else</span>
209:         <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">user_input</span>[<span class="ruby-identifier">:worker_method</span>])
210:       <span class="ruby-keyword kw">end</span>
211:       <span class="ruby-identifier">result</span> = <span class="ruby-value str">&quot;dummy_result&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">result</span>
212:       <span class="ruby-identifier">send_response</span>(<span class="ruby-identifier">p_data</span>,<span class="ruby-identifier">result</span>)
213:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000146"></a><b>receive_data</b>(p_data)
  </div>
  <div class="description">
  <p>
receives requests/responses from master process or other workers
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000146_source')" id="l_M000146_source">show source</a> ]</p>
  <div id="M000146_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File server/meta_worker.rb, line 184</span>
184:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">receive_data</span> <span class="ruby-identifier">p_data</span>
185:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p_data</span>[<span class="ruby-identifier">:data</span>][<span class="ruby-identifier">:worker_method</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:exit</span>
186:         <span class="ruby-identifier">exit</span>
187:         <span class="ruby-keyword kw">return</span>
188:       <span class="ruby-keyword kw">end</span>
189:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">p_data</span>[<span class="ruby-identifier">:type</span>]
190:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:request</span><span class="ruby-operator">:</span> <span class="ruby-identifier">process_request</span>(<span class="ruby-identifier">p_data</span>)
191:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:response</span><span class="ruby-operator">:</span> <span class="ruby-identifier">process_response</span>(<span class="ruby-identifier">p_data</span>)
192:       <span class="ruby-keyword kw">end</span>
193:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000151"></a><b>register_result</b>(p_data)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000151_source')" id="l_M000151_source">show source</a> ]</p>
  <div id="M000151_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File server/meta_worker.rb, line 262</span>
262:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">register_result</span> <span class="ruby-identifier">p_data</span>
263:       <span class="ruby-identifier">result</span> = { <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:result</span>, <span class="ruby-identifier">:data</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">p_data</span> }
264:       <span class="ruby-keyword kw">begin</span>
265:         <span class="ruby-identifier">send_data</span>(<span class="ruby-identifier">result</span>)
266:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">TypeError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
267:         <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">to_s</span>)
268:         <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>))
269:       <span class="ruby-keyword kw">rescue</span>
270:         <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-identifier">$!</span>.<span class="ruby-identifier">to_s</span>)
271:         <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-identifier">$!</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>))
272:       <span class="ruby-keyword kw">end</span>
273:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000150"></a><b>register_status</b>(p_data)
  </div>
  <div class="description">
  <p>
probably this method should be made thread safe, so as a method needs to
have a lock or something before it can use the method
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000150_source')" id="l_M000150_source">show source</a> ]</p>
  <div id="M000150_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File server/meta_worker.rb, line 245</span>
245:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">register_status</span> <span class="ruby-identifier">p_data</span>
246:       <span class="ruby-identifier">status</span> = {<span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:status</span>,<span class="ruby-identifier">:data</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">p_data</span>}
247:       <span class="ruby-keyword kw">begin</span>
248:         <span class="ruby-identifier">send_data</span>(<span class="ruby-identifier">status</span>)
249:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">TypeError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
250:         <span class="ruby-identifier">status</span> = {<span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:status</span>,<span class="ruby-identifier">:data</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;invalid_status_dump_check_log&quot;</span>}
251:         <span class="ruby-identifier">send_data</span>(<span class="ruby-identifier">status</span>)
252:         <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">to_s</span>)
253:         <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>))
254:       <span class="ruby-keyword kw">rescue</span>
255:         <span class="ruby-identifier">status</span> = {<span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:status</span>,<span class="ruby-identifier">:data</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;invalid_status_dump_check_log&quot;</span>}
256:         <span class="ruby-identifier">send_data</span>(<span class="ruby-identifier">status</span>)
257:         <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-identifier">$!</span>.<span class="ruby-identifier">to_s</span>)
258:         <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-identifier">$!</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>))
259:       <span class="ruby-keyword kw">end</span>
260:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000156"></a><b>run_user_threads</b>()
  </div>
  <div class="description">
  <p>
method would allow user threads to run exclusively for a while
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000156_source')" id="l_M000156_source">show source</a> ]</p>
  <div id="M000156_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File server/meta_worker.rb, line 309</span>
309:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">run_user_threads</span>
310:       <span class="ruby-ivar">@thread_pool</span>.<span class="ruby-identifier">exclusive_run</span>
311:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000152"></a><b>send_response</b>(input,output)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000152_source')" id="l_M000152_source">show source</a> ]</p>
  <div id="M000152_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File server/meta_worker.rb, line 275</span>
275:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_response</span> <span class="ruby-identifier">input</span>,<span class="ruby-identifier">output</span>
276:       <span class="ruby-identifier">input</span>[<span class="ruby-identifier">:data</span>] = <span class="ruby-identifier">output</span>
277:       <span class="ruby-identifier">input</span>[<span class="ruby-identifier">:type</span>] = <span class="ruby-identifier">:response</span>
278:       <span class="ruby-keyword kw">begin</span>
279:         <span class="ruby-identifier">send_data</span>(<span class="ruby-identifier">input</span>)
280:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">TypeError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
281:         <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">to_s</span>)
282:         <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>))
283:         <span class="ruby-identifier">input</span>[<span class="ruby-identifier">:data</span>] = <span class="ruby-value str">&quot;invalid_result_dump_check_log&quot;</span>
284:         <span class="ruby-identifier">send_data</span>(<span class="ruby-identifier">input</span>)
285:       <span class="ruby-keyword kw">rescue</span>
286:         <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-identifier">$!</span>.<span class="ruby-identifier">to_s</span>)
287:         <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-identifier">$!</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>))
288:         <span class="ruby-identifier">input</span>[<span class="ruby-identifier">:data</span>] = <span class="ruby-value str">&quot;invalid_result_dump_check_log&quot;</span>
289:         <span class="ruby-identifier">send_data</span>(<span class="ruby-identifier">input</span>)
290:       <span class="ruby-keyword kw">end</span>
291:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000153"></a><b>unbind</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000153_source')" id="l_M000153_source">show source</a> ]</p>
  <div id="M000153_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File server/meta_worker.rb, line 293</span>
293:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unbind</span>; <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000144"></a><b>worker_init</b>()
  </div>
  <div class="description">
  <p>
does initialization of worker stuff and invokes create method in user
defined worker class
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000144_source')" id="l_M000144_source">show source</a> ]</p>
  <div id="M000144_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File server/meta_worker.rb, line 156</span>
156:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">worker_init</span>
157:       <span class="ruby-ivar">@thread_pool</span> = <span class="ruby-constant">ThreadPool</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">20</span>)
158: 
159:       <span class="ruby-ivar">@config_file</span> = <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">load</span>(<span class="ruby-constant">ERB</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">IO</span>.<span class="ruby-identifier">read</span>(<span class="ruby-node">&quot;#{RAILS_HOME}/config/backgroundrb.yml&quot;</span>)).<span class="ruby-identifier">result</span>)
160:       <span class="ruby-comment cmt"># load_rails_env</span>
161:       <span class="ruby-ivar">@logger</span> = <span class="ruby-constant">PacketLogger</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>)
162:       <span class="ruby-keyword kw">if</span>(<span class="ruby-ivar">@worker_options</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@worker_options</span>[<span class="ruby-identifier">:schedule</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">no_auto_load</span>)
163:         <span class="ruby-identifier">load_schedule_from_args</span>
164:       <span class="ruby-keyword kw">elsif</span>(<span class="ruby-ivar">@config_file</span>[<span class="ruby-identifier">:schedules</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@config_file</span>[<span class="ruby-identifier">:schedules</span>][<span class="ruby-identifier">worker_name</span>.<span class="ruby-identifier">to_sym</span>])
165:         <span class="ruby-ivar">@my_schedule</span> = <span class="ruby-ivar">@config_file</span>[<span class="ruby-identifier">:schedules</span>][<span class="ruby-identifier">worker_name</span>.<span class="ruby-identifier">to_sym</span>]
166:         <span class="ruby-identifier">new_load_schedule</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@my_schedule</span>
167:       <span class="ruby-keyword kw">end</span>
168:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:create</span>)
169:         <span class="ruby-identifier">create_arity</span> = <span class="ruby-identifier">method</span>(<span class="ruby-identifier">:create</span>).<span class="ruby-identifier">arity</span>
170:         (<span class="ruby-identifier">create_arity</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">create</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">create</span>(<span class="ruby-ivar">@worker_options</span>[<span class="ruby-identifier">:data</span>])
171:       <span class="ruby-keyword kw">end</span>
172:       <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-node">&quot;#{worker_name} started&quot;</span>
173:       <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-value str">&quot;Schedules for worker loaded&quot;</span>
174:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>

    </body>
</html>