<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>Class: Packet::Reactor</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />

    <script language="JavaScript" type="text/javascript">
    // <![CDATA[

        function toggleSource( id )
        {
          var elem
          var link

          if( document.getElementById )
          {
            elem = document.getElementById( id )
            link = document.getElementById( "l_" + id )
          }
          else if ( document.all )
          {
            elem = eval( "document.all." + id )
            link = eval( "document.all.l_" + id )
          }
          else
            return false;

          if( elem.style.display == "block" )
          {
            elem.style.display = "none"
            link.innerHTML = "show source"
          }
          else
          {
            elem.style.display = "block"
            link.innerHTML = "hide source"
          }
        }

        function openCode( url )
        {
          window.open( url, "SOURCE_CODE", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=480,width=750" ).focus();
        }
      // ]]>
    </script>
  </head>

  <body>
  <table width="100%" border='0' cellpadding='0' cellspacing='0' class='banner'><tr>
  <td class="file-title"><span class="file-title-prefix">Class</span><br />Packet::Reactor</td>
  <td align="right">
    <table cellspacing="0" cellpadding="2">
      <tr valign="top">
        <td>In:</td>
        <td>
<a href="../../files/framework/packet_master_rb.html">framework/packet_master.rb</a>
        </td>
      </tr>
    <tr>
      <td>Parent:</td>
      <td>
        <a href="../Object.html">
Object
         </a>
     </td>
   </tr>
         </table>
        </td>
        </tr>
      </table>
 <!-- banner header -->

  <div id="bodyContent">
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="#M000091">delete_worker</a></li>
  <li><a href="#M000094">fork_and_load</a></li>
  <li><a href="#M000090">handle_internal_messages</a></li>
  <li><a href="#M000092">load_workers</a></li>
  <li><a href="#M000089">provide_workers</a></li>
  <li><a href="#M000086">run</a></li>
  <li><a href="#M000085">server_logger=</a></li>
  <li><a href="#M000087">set_result_hash</a></li>
  <li><a href="#M000093">start_worker</a></li>
  <li><a href="#M000088">update_result</a></li>
  </ul>

<div class="sectiontitle">Included Modules</div>
<ul>
  <li><a href="Core.html">Core</a></li>
</ul>




  <div class="sectiontitle">Attributes</div>
  <table border='0' cellpadding='5'>
  <tr valign='top'>
    <td class='attr-rw'>
[RW]
    </td>
    <td class='attr-name'>fd_writers</td>
    <td class='attr-desc'></td>
  </tr>
  <tr valign='top'>
    <td class='attr-rw'>
[RW]
    </td>
    <td class='attr-name'>live_workers</td>
    <td class='attr-desc'></td>
  </tr>
  <tr valign='top'>
    <td class='attr-rw'>
[RW]
    </td>
    <td class='attr-name'>msg_reader</td>
    <td class='attr-desc'></td>
  </tr>
  <tr valign='top'>
    <td class='attr-rw'>
[RW]
    </td>
    <td class='attr-name'>msg_writers</td>
    <td class='attr-desc'></td>
  </tr>
  <tr valign='top'>
    <td class='attr-rw'>
[RW]
    </td>
    <td class='attr-name'>result_hash</td>
    <td class='attr-desc'></td>
  </tr>
  </table>

<div class="sectiontitle">Public Class methods</div>
<div class="method">
  <div class="title">
    <a name="M000086"></a><b>run</b>() {|master_reactor_instance| ...}
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000086_source')" id="l_M000086_source">show source</a> ]</p>
  <div id="M000086_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File framework/packet_master.rb, line 14</span>
14:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">run</span>
15:       <span class="ruby-identifier">master_reactor_instance</span> = <span class="ruby-identifier">new</span>
16:       <span class="ruby-comment cmt"># master_reactor_instance.result_hash = {}</span>
17:       <span class="ruby-identifier">master_reactor_instance</span>.<span class="ruby-identifier">live_workers</span> = <span class="ruby-constant">DoubleKeyedHash</span>.<span class="ruby-identifier">new</span>
18:       <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">master_reactor_instance</span>)
19:       <span class="ruby-identifier">master_reactor_instance</span>.<span class="ruby-identifier">load_workers</span>
20:       <span class="ruby-identifier">master_reactor_instance</span>.<span class="ruby-identifier">start_reactor</span>
21:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000085"></a><b>server_logger=</b>(log_file_name)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000085_source')" id="l_M000085_source">show source</a> ]</p>
  <div id="M000085_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File framework/packet_master.rb, line 10</span>
10:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">server_logger=</span> (<span class="ruby-identifier">log_file_name</span>)
11:       <span class="ruby-ivar">@@server_logger</span> = <span class="ruby-identifier">log_file_name</span>
12:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Public Instance methods</div>
<div class="method">
  <div class="title">
    <a name="M000091"></a><b>delete_worker</b>(worker_options = {})
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000091_source')" id="l_M000091_source">show source</a> ]</p>
  <div id="M000091_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File framework/packet_master.rb, line 69</span>
69:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_worker</span>(<span class="ruby-identifier">worker_options</span> = {})
70:       <span class="ruby-identifier">worker_name</span> = <span class="ruby-identifier">worker_options</span>[<span class="ruby-identifier">:worker</span>]
71:       <span class="ruby-identifier">worker_name_key</span> = <span class="ruby-identifier">gen_worker_key</span>(<span class="ruby-identifier">worker_name</span>,<span class="ruby-identifier">worker_options</span>[<span class="ruby-identifier">:job_key</span>])
72:       <span class="ruby-identifier">worker_options</span>[<span class="ruby-identifier">:method</span>] = <span class="ruby-identifier">:exit</span>
73:       <span class="ruby-ivar">@live_workers</span>[<span class="ruby-identifier">worker_name_key</span>].<span class="ruby-identifier">send_request</span>(<span class="ruby-identifier">worker_options</span>)
74:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000094"></a><b>fork_and_load</b>(worker_klass,worker_options = { })
  </div>
  <div class="description">
  <p>
method forks given worker file in a new process method should use job_key
if provided in options hash.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000094_source')" id="l_M000094_source">show source</a> ]</p>
  <div id="M000094_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File framework/packet_master.rb, line 115</span>
115:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fork_and_load</span>(<span class="ruby-identifier">worker_klass</span>,<span class="ruby-identifier">worker_options</span> = { })
116:       <span class="ruby-identifier">t_worker_name</span> = <span class="ruby-identifier">worker_klass</span>.<span class="ruby-identifier">worker_name</span>
117:       <span class="ruby-identifier">worker_pimp</span> = <span class="ruby-identifier">worker_klass</span>.<span class="ruby-identifier">worker_proxy</span>.<span class="ruby-identifier">to_s</span>
118: 
119:       <span class="ruby-comment cmt"># socket from which master process is going to read</span>
120:       <span class="ruby-identifier">master_read_end</span>,<span class="ruby-identifier">worker_write_end</span> = <span class="ruby-constant">UNIXSocket</span>.<span class="ruby-identifier">pair</span>(<span class="ruby-constant">Socket</span><span class="ruby-operator">::</span><span class="ruby-constant">SOCK_STREAM</span>)
121:       <span class="ruby-comment cmt"># socket to which master process is going to write</span>
122:       <span class="ruby-identifier">worker_read_end</span>,<span class="ruby-identifier">master_write_end</span> = <span class="ruby-constant">UNIXSocket</span>.<span class="ruby-identifier">pair</span>(<span class="ruby-constant">Socket</span><span class="ruby-operator">::</span><span class="ruby-constant">SOCK_STREAM</span>)
123:       <span class="ruby-identifier">worker_read_fd</span>,<span class="ruby-identifier">master_write_fd</span> = <span class="ruby-constant">UNIXSocket</span>.<span class="ruby-identifier">pair</span>
124: 
125:       <span class="ruby-keyword kw">if</span>((<span class="ruby-identifier">pid</span> = <span class="ruby-identifier">fork</span>()).<span class="ruby-identifier">nil?</span>)
126:         <span class="ruby-identifier">$0</span> = <span class="ruby-node">&quot;ruby #{worker_klass.worker_name}&quot;</span>
127:         [<span class="ruby-identifier">master_write_end</span>,<span class="ruby-identifier">master_read_end</span>,<span class="ruby-identifier">master_write_fd</span>].<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">close</span> }
128: 
129:         <span class="ruby-identifier">worker_klass</span>.<span class="ruby-identifier">start_worker</span>(<span class="ruby-identifier">:write_end</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">worker_write_end</span>,<span class="ruby-identifier">:read_end</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">worker_read_end</span>,\
130:                                   <span class="ruby-identifier">:read_fd</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">worker_read_fd</span>,<span class="ruby-identifier">:options</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">worker_options</span>)
131:       <span class="ruby-keyword kw">end</span>
132:       <span class="ruby-constant">Process</span>.<span class="ruby-identifier">detach</span>(<span class="ruby-identifier">pid</span>)
133: 
134:       <span class="ruby-identifier">worker_name_key</span> = <span class="ruby-identifier">gen_worker_key</span>(<span class="ruby-identifier">t_worker_name</span>,<span class="ruby-identifier">worker_options</span>[<span class="ruby-identifier">:job_key</span>])
135: 
136:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">worker_pimp</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">worker_pimp</span>.<span class="ruby-identifier">empty?</span>
137:         <span class="ruby-identifier">require</span> <span class="ruby-identifier">worker_pimp</span>
138:         <span class="ruby-identifier">pimp_klass</span> = <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">packet_classify</span>(<span class="ruby-identifier">worker_pimp</span>))
139:         <span class="ruby-ivar">@live_workers</span>[<span class="ruby-identifier">worker_name_key</span>,<span class="ruby-identifier">master_read_end</span>.<span class="ruby-identifier">fileno</span>] = <span class="ruby-identifier">pimp_klass</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">master_write_end</span>,<span class="ruby-identifier">pid</span>,<span class="ruby-keyword kw">self</span>)
140:       <span class="ruby-keyword kw">else</span>
141:         <span class="ruby-identifier">t_pimp</span> = <span class="ruby-constant">Packet</span><span class="ruby-operator">::</span><span class="ruby-constant">MetaPimp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">master_write_end</span>,<span class="ruby-identifier">pid</span>,<span class="ruby-keyword kw">self</span>)
142:         <span class="ruby-identifier">t_pimp</span>.<span class="ruby-identifier">worker_key</span> = <span class="ruby-identifier">worker_name_key</span>
143:         <span class="ruby-ivar">@live_workers</span>[<span class="ruby-identifier">worker_name_key</span>,<span class="ruby-identifier">master_read_end</span>.<span class="ruby-identifier">fileno</span>] = <span class="ruby-identifier">t_pimp</span>
144:       <span class="ruby-keyword kw">end</span>
145: 
146:       <span class="ruby-identifier">worker_read_end</span>.<span class="ruby-identifier">close</span>
147:       <span class="ruby-identifier">worker_write_end</span>.<span class="ruby-identifier">close</span>
148:       <span class="ruby-identifier">worker_read_fd</span>.<span class="ruby-identifier">close</span>
149:       <span class="ruby-identifier">read_ios</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">master_read_end</span>
150:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000090"></a><b>handle_internal_messages</b>(t_sock)
  </div>
  <div class="description">
  <p>
FIXME: right now, each worker is tied to its connection and this can be
problematic what if a worker wants to return results in a async manner
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000090_source')" id="l_M000090_source">show source</a> ]</p>
  <div id="M000090_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File framework/packet_master.rb, line 57</span>
57:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">handle_internal_messages</span>(<span class="ruby-identifier">t_sock</span>)
58:       <span class="ruby-identifier">sock_fd</span> = <span class="ruby-identifier">t_sock</span>.<span class="ruby-identifier">fileno</span>
59:       <span class="ruby-identifier">worker_instance</span> = <span class="ruby-ivar">@live_workers</span>[<span class="ruby-identifier">sock_fd</span>]
60:       <span class="ruby-keyword kw">begin</span>
61:         <span class="ruby-identifier">raw_data</span> = <span class="ruby-identifier">read_data</span>(<span class="ruby-identifier">t_sock</span>)
62:         <span class="ruby-comment cmt"># t_data = Marshal.load(raw_data)</span>
63:         <span class="ruby-identifier">worker_instance</span>.<span class="ruby-identifier">receive_data</span>(<span class="ruby-identifier">raw_data</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">worker_instance</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:receive_data</span>)
64:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">DisconnectError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sock_error</span>
65:         <span class="ruby-identifier">read_ios</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">t_sock</span>)
66:       <span class="ruby-keyword kw">end</span>
67:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000092"></a><b>load_workers</b>()
  </div>
  <div class="description">
  <p>
method loads workers in new processes FIXME: this method can be fixed, so
as worker code can be actually, required only in forked process and hence
saving upon the memory involved where worker is actually required in master
as well as in worker.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000092_source')" id="l_M000092_source">show source</a> ]</p>
  <div id="M000092_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File framework/packet_master.rb, line 80</span>
 80:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_workers</span>
 81:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">WORKER_ROOT</span>)
 82:         <span class="ruby-identifier">worker_root</span> = <span class="ruby-constant">WORKER_ROOT</span>
 83:       <span class="ruby-keyword kw">else</span>
 84:         <span class="ruby-identifier">worker_root</span> = <span class="ruby-node">&quot;#{PACKET_APP}/worker&quot;</span>
 85:       <span class="ruby-keyword kw">end</span>
 86:       <span class="ruby-identifier">t_workers</span> = <span class="ruby-constant">Dir</span>[<span class="ruby-node">&quot;#{worker_root}/**/*.rb&quot;</span>]
 87:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t_workers</span>.<span class="ruby-identifier">empty?</span>
 88:       <span class="ruby-identifier">t_workers</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">b_worker</span><span class="ruby-operator">|</span>
 89:         <span class="ruby-identifier">worker_name</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">b_worker</span>,<span class="ruby-value str">&quot;.rb&quot;</span>)
 90:         <span class="ruby-identifier">require</span> <span class="ruby-identifier">worker_name</span>
 91:         <span class="ruby-identifier">worker_klass</span> = <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">packet_classify</span>(<span class="ruby-identifier">worker_name</span>))
 92:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">worker_klass</span>.<span class="ruby-identifier">no_auto_load</span>
 93:         <span class="ruby-identifier">fork_and_load</span>(<span class="ruby-identifier">worker_klass</span>)
 94:       <span class="ruby-keyword kw">end</span>
 95: 
 96:       <span class="ruby-comment cmt"># FIXME: easiest and yet perhaps a bit ugly, its just to make sure that from each</span>
 97:       <span class="ruby-comment cmt"># worker proxy one can access other workers</span>
 98:       <span class="ruby-ivar">@live_workers</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>,<span class="ruby-identifier">worker_instance</span><span class="ruby-operator">|</span>
 99:         <span class="ruby-identifier">worker_instance</span>.<span class="ruby-identifier">workers</span> = <span class="ruby-ivar">@live_workers</span>
100:       <span class="ruby-keyword kw">end</span>
101:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000089"></a><b>provide_workers</b>(handler_instance,t_sock)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000089_source')" id="l_M000089_source">show source</a> ]</p>
  <div id="M000089_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File framework/packet_master.rb, line 32</span>
32:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">provide_workers</span>(<span class="ruby-identifier">handler_instance</span>,<span class="ruby-identifier">t_sock</span>)
33:       <span class="ruby-keyword kw">class</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">handler_instance</span>
34:         <span class="ruby-identifier">extend</span> <span class="ruby-constant">Forwardable</span>
35:         <span class="ruby-identifier">attr_accessor</span> <span class="ruby-identifier">:workers</span>,<span class="ruby-identifier">:connection</span>,<span class="ruby-identifier">:reactor</span>, <span class="ruby-identifier">:initialized</span>,<span class="ruby-identifier">:signature</span>
36:         <span class="ruby-identifier">include</span> <span class="ruby-constant">NbioHelper</span>
37:         <span class="ruby-identifier">include</span> <span class="ruby-constant">Connection</span>
38:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ask_worker</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
39:           <span class="ruby-identifier">worker_name</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>
40:           <span class="ruby-identifier">data_options</span> = <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
41:           <span class="ruby-identifier">worker_name_key</span> = <span class="ruby-identifier">gen_worker_key</span>(<span class="ruby-identifier">worker_name</span>,<span class="ruby-identifier">data_options</span>[<span class="ruby-identifier">:job_key</span>])
42:           <span class="ruby-identifier">data_options</span>[<span class="ruby-identifier">:client_signature</span>] = <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">fileno</span>
43:           <span class="ruby-identifier">workers</span>[<span class="ruby-identifier">worker_name_key</span>].<span class="ruby-identifier">send_request</span>(<span class="ruby-identifier">data_options</span>)
44:         <span class="ruby-keyword kw">end</span>
45: 
46:         <span class="ruby-identifier">def_delegators</span>(<span class="ruby-identifier">:@reactor</span>, <span class="ruby-identifier">:start_server</span>, <span class="ruby-identifier">:connect</span>, <span class="ruby-identifier">:add_periodic_timer</span>, \
47:                          <span class="ruby-identifier">:add_timer</span>, <span class="ruby-identifier">:cancel_timer</span>,<span class="ruby-identifier">:reconnect</span>, <span class="ruby-identifier">:start_worker</span>,<span class="ruby-identifier">:delete_worker</span>)
48: 
49:       <span class="ruby-keyword kw">end</span>
50:       <span class="ruby-identifier">handler_instance</span>.<span class="ruby-identifier">workers</span> = <span class="ruby-ivar">@live_workers</span>
51:       <span class="ruby-identifier">handler_instance</span>.<span class="ruby-identifier">connection</span> = <span class="ruby-identifier">t_sock</span>
52:       <span class="ruby-identifier">handler_instance</span>.<span class="ruby-identifier">reactor</span> = <span class="ruby-keyword kw">self</span>
53:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000087"></a><b>set_result_hash</b>(hash)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000087_source')" id="l_M000087_source">show source</a> ]</p>
  <div id="M000087_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File framework/packet_master.rb, line 23</span>
23:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_result_hash</span>(<span class="ruby-identifier">hash</span>)
24:       <span class="ruby-ivar">@result_hash</span> = <span class="ruby-identifier">hash</span>
25:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000093"></a><b>start_worker</b>(worker_options = { })
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000093_source')" id="l_M000093_source">show source</a> ]</p>
  <div id="M000093_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File framework/packet_master.rb, line 103</span>
103:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">start_worker</span>(<span class="ruby-identifier">worker_options</span> = { })
104:       <span class="ruby-identifier">worker_name</span> = <span class="ruby-identifier">worker_options</span>[<span class="ruby-identifier">:worker</span>].<span class="ruby-identifier">to_s</span>
105:       <span class="ruby-identifier">worker_name_key</span> = <span class="ruby-identifier">gen_worker_key</span>(<span class="ruby-identifier">worker_name</span>,<span class="ruby-identifier">worker_options</span>[<span class="ruby-identifier">:job_key</span>])
106:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@live_workers</span>[<span class="ruby-identifier">worker_name_key</span>]
107:       <span class="ruby-identifier">worker_options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:worker</span>)
108:       <span class="ruby-identifier">require</span> <span class="ruby-identifier">worker_name</span>
109:       <span class="ruby-identifier">worker_klass</span> = <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">packet_classify</span>(<span class="ruby-identifier">worker_name</span>))
110:       <span class="ruby-identifier">fork_and_load</span>(<span class="ruby-identifier">worker_klass</span>,<span class="ruby-identifier">worker_options</span>)
111:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000088"></a><b>update_result</b>(worker_key,result)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000088_source')" id="l_M000088_source">show source</a> ]</p>
  <div id="M000088_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File framework/packet_master.rb, line 27</span>
27:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_result</span>(<span class="ruby-identifier">worker_key</span>,<span class="ruby-identifier">result</span>)
28:       <span class="ruby-ivar">@result_hash</span> <span class="ruby-operator">||=</span> {}
29:       <span class="ruby-ivar">@result_hash</span>[<span class="ruby-identifier">worker_key</span>.<span class="ruby-identifier">to_sym</span>] = <span class="ruby-identifier">result</span>
30:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>

    </body>
</html>